async function loadInitialData() {
            let dataLoaded = false;
            // 1. Intentar obtener datos desde la API (Vercel Blob)
            try {
                const response = await fetch('/api/get-data');
                if (response.ok) {
                    let data = await response.json();
                    // Asegurarse de que la data es un array
                    if (Array.isArray(data)) {
                        employees = data;
                        dataLoaded = true;
                    }
                }
            } catch (error) {
                console.warn("No se pudo cargar la API, intentando JSON estático...", error);
            }

            // 2. Si no se cargó data de la API, intentar el JSON estático
            if (!dataLoaded) {
                try {
                    const jsonResponse = await fetch('/directorio_empleados_barceloneta.json');
                    if (jsonResponse.ok) {
                        let data = await jsonResponse.json();
                        if (Array.isArray(data) && data.length > 0) {
                            employees = data;
                            dataLoaded = true;
                        }
                    }
                } catch (error) {
                    console.warn("No se pudo cargar el JSON estático, intentando CSV local...", error);
                }
            }

            // 3. Si no se cargó data del JSON, leer el CSV local
            if (!dataLoaded) {
                try {
                    const csvResponse = await fetch('/directorio_empleados_barceloneta.csv');
                    if (csvResponse.ok) {
                        const csvText = await csvResponse.text();
                        parseCSVData(csvText, true); // llena 'employees'
                        if (employees.length > 0) {
                            dataLoaded = true;
                        }
                    } else {
                        console.warn("No se encontró el archivo CSV local.");
                    }
                } catch (error) {
                    console.error("Error cargando el CSV local:", error);
                }
            }

            // 4. Si después de todo no hay datos, intentar cargar desde localStorage
            if (!dataLoaded) {
                const savedData = localStorage.getItem('companyEmployees');
                if (savedData) {
                    employees = JSON.parse(savedData);
                } else {
                    employees = []; // Empezar vacío si no hay nada
                }
            }
            
            // Finalmente, actualiza la vista con los datos cargados
            displayEmployees();
            updateFilters();
            updateStats();
        }

        async function saveDataToServer(isInitialLoad = false) {
            if (!isInitialLoad && !checkPermission('save')) return;

            if (!isInitialLoad && !confirm('¿Estás seguro de que quieres sobrescribir los datos en el servidor con los datos actuales? Esta acción es irreversible.')) {
                return;
            }

            try {
                const response = await fetch('/api/save-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(employees) 
                });

                const result = await response.json();

                if (result.success) {
                    if (!isInitialLoad) {
                        alert('✅ ¡Éxito! Los datos han sido guardados en el servidor.');
                        // Después de guardar, recargamos los datos para asegurar consistencia
                        await loadInitialData(); 
                    }
                    // Guardamos también en el respaldo local
                    saveEmployees();
                } else {
                    if (!isInitialLoad) {
                        alert(`❌ Error al guardar los datos en el servidor.\n\nDetalle: ${result.message}`);
                    }
                }
            } catch (error) {
                console.error('Error al contactar el servidor:', error);
                if (!isInitialLoad) {
                    alert('❌ Error de conexión. No se pudo contactar al servidor para guardar los datos.');
                }
            }
        }